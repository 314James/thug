<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Logging &mdash; Thug 0.5.5 documentation</title>
    
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Thug 0.5.5 documentation" href="index.html" />
    <link rel="next" title="Plugin Framework" href="plugins.html" />
    <link rel="prev" title="Thug API" href="api.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plugins.html" title="Plugin Framework"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api.html" title="Thug API"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Thug 0.5.5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="logging">
<span id="id1"></span><h1>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mongodb-logging-module">
<h2>MongoDB Logging module<a class="headerlink" href="#mongodb-logging-module" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mongodb-collection-schema">
<h3>MongoDB collection schema<a class="headerlink" href="#mongodb-collection-schema" title="Permalink to this headline">¶</a></h3>
<div class="section" id="collection-urls">
<h4>Collection urls<a class="headerlink" href="#collection-urls" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>urls</em> is used to keep track of the URLs visited during the analysis.
A URL is always associated a single entry in this collection even if it is visited
multiple times (during the same analysis or in different analyses). Associating a
unique ObjectID to a given URL allows to easily spot interesting scenarios like
different redirection chains ending up using the same URLs.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;url&quot;</span> : URL
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-analyses">
<h4>Collection analyses<a class="headerlink" href="#collection-analyses" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>analyses</em> is used to keep track of the Thug analyses. The analysis
options used for the single analysis are stored together with other useful information
like the used Thug version and the analysis datetime. Moreover the URL ObjectID of the
initial URL is stored for convenience.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;url_id&quot;</span>      : Initial URL url_id
    <span class="s2">&quot;timestamp&quot;</span>   : Analysis datetime
    <span class="s2">&quot;thug&quot;</span>        : <span class="o">{</span>
                        <span class="s2">&quot;version&quot;</span>            : Thug version
                        <span class="s2">&quot;personality&quot;</span> : <span class="o">{</span>
                            <span class="s2">&quot;useragent&quot;</span>      : User Agent
                        <span class="o">}</span>,
                        <span class="s2">&quot;plugins&quot;</span> : <span class="o">{</span>
                            <span class="s2">&quot;acropdf&quot;</span>        : Acrobat Reader version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                            <span class="s2">&quot;javaplugin&quot;</span>     : JavaPlugin version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                            <span class="s2">&quot;shockwaveflash&quot;</span> : Shockwave Flash version <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                        <span class="o">}</span>,
                        <span class="s2">&quot;options&quot;</span> : <span class="o">{</span>
                            <span class="s2">&quot;local&quot;</span>          : Local analysis
                            <span class="s2">&quot;nofetch&quot;</span>        : Local no-fetch analysis
                            <span class="s2">&quot;proxy&quot;</span>          : Proxy <span class="o">(</span><span class="k">if</span> any<span class="o">)</span>
                            <span class="s2">&quot;events&quot;</span>         : Additional DOM events to be processed
                            <span class="s2">&quot;delay&quot;</span>          : Maximum setTimeout/setInterval delay value <span class="o">(</span>in milliseconds<span class="o">)</span>
                            <span class="s2">&quot;referer&quot;</span>        : Referer
                            <span class="s2">&quot;timeout&quot;</span>        : Analysis timeout
                            <span class="s2">&quot;threshold&quot;</span>      : Maximum pages to fetch
                            <span class="s2">&quot;extensive&quot;</span>      : Extensive fetch of linked pages
                        <span class="o">}</span>,
                    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-connections">
<h4>Collection connections<a class="headerlink" href="#collection-connections" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>connections</em> is used to keep track of the redirections which could happen
during the single analysis. The field <em>chain_id</em> is a counter which is incremented by one at
every redirection and it&#8217;s meant to be used in order to rebuild the redirection chain in the
right order while analyzing data.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>    : Analysis ID
    <span class="s2">&quot;chain_id&quot;</span>       : Chain ID
    <span class="s2">&quot;source_id&quot;</span>      : Source URL url_id
    <span class="s2">&quot;destination_id&quot;</span> : Destination URL url_id
    <span class="s2">&quot;method&quot;</span>         : Method
    <span class="s2">&quot;flags&quot;</span>          : Flags
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-locations">
<h4>Collection locations<a class="headerlink" href="#collection-locations" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>locations</em> is used to keep track of the content stored at each URL visited
during the analysis. The content is stored in a MongoDB GridFS and additional metadata are
saved like MD5 and SHA-256 checksums, content size, content type (as served by the server)
and evaluated content type.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;url_id&quot;</span>        : URL url_id
    <span class="s2">&quot;content_id&quot;</span>    : Content ID <span class="o">(</span>content stored in the GridFS fs<span class="o">)</span>
    <span class="s2">&quot;content-type&quot;</span>  : Content Type
    <span class="s2">&quot;md5&quot;</span>           : MD5 checksum
    <span class="s2">&quot;sha256&quot;</span>        : SHA-256 checksum
    <span class="s2">&quot;flags&quot;</span>         : Flags
    <span class="s2">&quot;size&quot;</span>          : Data size
    <span class="s2">&quot;mime-type&quot;</span>     : Evaluated content <span class="nb">type</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-samples">
<h4>Collection samples<a class="headerlink" href="#collection-samples" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>samples</em> is used to keep track of the downloaded samples (currently supported
types: PE, PDF, JAR and SWF). The sample itself is stored in a MongoDB GridFS and additional
metadata are saved like MD5 and SHA-1 checksums, sample type and imphash (if the sample type
is PE).</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;url_id&quot;</span>        : URL url_id
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID <span class="o">(</span>sample stored in the GridFS fs<span class="o">)</span>
    <span class="s2">&quot;type&quot;</span>          : Sample <span class="nb">type</span>
    <span class="s2">&quot;md5&quot;</span>           : MD5 checksum
    <span class="s2">&quot;sha1&quot;</span>          : SHA-1 checksum
    <span class="s2">&quot;imphash&quot;</span>       : Imphash <span class="o">(</span><span class="k">if</span> <span class="nb">type </span>is PE<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-exploits">
<h4>Collection exploits<a class="headerlink" href="#collection-exploits" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>eploits</em> is used to keep track of the exploits which were successfully
identified during the analysis while visiting the URL referenced by <em>url_id</em>.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s1">&#39;analysis_id&#39;</span> : Analysis ID
    <span class="s1">&#39;url_id&#39;</span>      : URL url_id
    <span class="s1">&#39;module&#39;</span>      : Module/ActiveX Control, etc. that gets exploited
    <span class="s1">&#39;description&#39;</span> : Description of the exploit
    <span class="s1">&#39;cve&#39;</span>         : CVE number <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;data&#39;</span>        : Additional information
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-codes">
<h4>Collection codes<a class="headerlink" href="#collection-codes" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>codes</em> is used to keep track of the (dynamic language) snippets of code
identified during the analysis.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s1">&#39;analysis_id&#39;</span>  : Analysis ID
    <span class="s1">&#39;snippet&#39;</span>      : Code snippet
    <span class="s1">&#39;language&#39;</span>     : Code language
    <span class="s1">&#39;relationship&#39;</span> : Relationship with the page that references the code
    <span class="s1">&#39;method&#39;</span>       : Analysis method
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-behaviors">
<h4>Collection behaviors<a class="headerlink" href="#collection-behaviors" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>behaviors</em> is used to keep track of the suspicious and/or malicious
behaviors observed during the analysis.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s1">&#39;analysis_id&#39;</span> : Analysis ID
    <span class="s1">&#39;description&#39;</span> : Observed behavior description
    <span class="s1">&#39;cve&#39;</span>         : CVE number <span class="o">(</span><span class="k">if</span> available<span class="o">)</span>
    <span class="s1">&#39;method&#39;</span>      : Analysis method
    <span class="s1">&#39;timestamp&#39;</span>   : Timestamp
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-certificates">
<h4>Collection certificates<a class="headerlink" href="#collection-certificates" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>certificates</em> is used to store the SSL certificates collected from
servers during the analysis.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;url_id&quot;</span>        : URL url_id
    <span class="s2">&quot;certificate&quot;</span>   : SSL certificate
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-graphs">
<h4>Collection graphs<a class="headerlink" href="#collection-graphs" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>graphs</em> is used to store the analysis JSON exploit graph.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;graph&quot;</span>         : JSON exploit graph
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-virustotal">
<h4>Collection virustotal<a class="headerlink" href="#collection-virustotal" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>virustotal</em> is used to store the VirusTotal sample analysis reports.
The Sample ObjectID references the <em>samples</em> collection.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID
    <span class="s2">&quot;report&quot;</span>        : VirusTotal report <span class="o">(</span>JSON<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-honeyagent">
<h4>Collection honeyagent<a class="headerlink" href="#collection-honeyagent" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>honeyagent</em> is used to store the HoneyAgent Java sandbox sample analysis
reports. The Sample ObjectID references the <em>samples</em> collection.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID
    <span class="s2">&quot;report&quot;</span>        : HoneyAgent report <span class="o">(</span>JSON<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-androguard">
<h4>Collection androguard<a class="headerlink" href="#collection-androguard" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>androguard</em> is used to store the Androguard APK sample analysis reports.
The Sample ObjectID references the <em>samples</em> collection.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID
    <span class="s2">&quot;report&quot;</span>        : Androguard report <span class="o">(</span>TXT<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="collection-peepdf">
<h4>Collection peepdf<a class="headerlink" href="#collection-peepdf" title="Permalink to this headline">¶</a></h4>
<p>The collection <em>peepdf</em> is used to store the PeePDF PDF sample analysis reports.
The Sample ObjectID references the <em>samples</em> collection.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">{</span>
    <span class="s2">&quot;analysis_id&quot;</span>   : Analysis ID
    <span class="s2">&quot;sample_id&quot;</span>     : Sample ID
    <span class="s2">&quot;report&quot;</span>        : PeePDF report <span class="o">(</span>XML<span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Logging</a><ul>
<li><a class="reference internal" href="#mongodb-logging-module">MongoDB Logging module</a><ul>
<li><a class="reference internal" href="#mongodb-collection-schema">MongoDB collection schema</a><ul>
<li><a class="reference internal" href="#collection-urls">Collection urls</a></li>
<li><a class="reference internal" href="#collection-analyses">Collection analyses</a></li>
<li><a class="reference internal" href="#collection-connections">Collection connections</a></li>
<li><a class="reference internal" href="#collection-locations">Collection locations</a></li>
<li><a class="reference internal" href="#collection-samples">Collection samples</a></li>
<li><a class="reference internal" href="#collection-exploits">Collection exploits</a></li>
<li><a class="reference internal" href="#collection-codes">Collection codes</a></li>
<li><a class="reference internal" href="#collection-behaviors">Collection behaviors</a></li>
<li><a class="reference internal" href="#collection-certificates">Collection certificates</a></li>
<li><a class="reference internal" href="#collection-graphs">Collection graphs</a></li>
<li><a class="reference internal" href="#collection-virustotal">Collection virustotal</a></li>
<li><a class="reference internal" href="#collection-honeyagent">Collection honeyagent</a></li>
<li><a class="reference internal" href="#collection-androguard">Collection androguard</a></li>
<li><a class="reference internal" href="#collection-peepdf">Collection peepdf</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="api.html"
                        title="previous chapter">Thug API</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plugins.html"
                        title="next chapter">Plugin Framework</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/logging.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plugins.html" title="Plugin Framework"
             >next</a> |</li>
        <li class="right" >
          <a href="api.html" title="Thug API"
             >previous</a> |</li>
        <li><a href="index.html">Thug 0.5.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2014, Angelo Dell&#39;Aera.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>
