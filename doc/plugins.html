<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Plugin Framework &mdash; Thug 0.8rc3 documentation</title>
    
    <link rel="stylesheet" href="static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8rc3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Thug 0.8rc3 documentation" href="index.html" />
    <link rel="prev" title="Logging" href="logging.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="plugin-framework">
<h1>Plugin Framework<a class="headerlink" href="#plugin-framework" title="Permalink to this headline">¶</a></h1>
<p>The Thug Plugin Framework was introduced in version 0.3.0. If you ever thought about extending Thug
with additional features but do not know how to do it you should really keep on reading. Let&#8217;s start
by taking a look a the code.</p>
<p>Taking a look at <em>src/thug.py</em> we can now read these lines of code</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">ThugPlugins</span><span class="p">(</span><span class="n">PRE_ANALYSIS_PLUGINS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)()</span>
        <span class="n">p</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ThugPlugins</span><span class="p">(</span><span class="n">POST_ANALYSIS_PLUGINS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)()</span>
</pre></div>
</div>
<p>Please note that every operation performed by Thug is started by the line <em>p(args[0])</em> so you can
realize that two hooks exist in order to execute plugins in a pre and post-analysis stage. Let’s keep
exploring the source code and let&#8217;s take a look at <em>src/Plugins/ThugPlugins.py</em>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThugPlugins</span><span class="p">:</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">PRE_ANALYSIS_PLUGINS</span>  <span class="p">:</span> <span class="s1">&#39;ThugPluginsPre&#39;</span><span class="p">,</span>
                <span class="n">POST_ANALYSIS_PLUGINS</span> <span class="p">:</span> <span class="s1">&#39;ThugPluginsPost&#39;</span>
                <span class="p">}</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">thug</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thug</span>  <span class="o">=</span> <span class="n">thug</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__init_config</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">__init_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">config</span>       <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>

                <span class="n">conf_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s1">&#39;plugins.conf&#39;</span><span class="p">)</span>
                <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">conf_file</span><span class="p">)</span>

                <span class="n">plugins</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phases</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">],</span> <span class="s1">&#39;plugins&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">plugins</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
                        <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                        <span class="n">components</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                                <span class="n">module</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

                        <span class="n">handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s2">&quot;Handler&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">handler</span><span class="p">:</span>
                                <span class="n">p</span> <span class="o">=</span> <span class="n">handler</span><span class="p">()</span>
                                <span class="k">try</span><span class="p">:</span>
                                        <span class="n">verifyObject</span><span class="p">(</span><span class="n">IPlugin</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                                        <span class="n">p</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thug</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
                                <span class="k">except</span> <span class="n">BrokenImplementation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="p">))</span>
</pre></div>
</div>
<p>and <em>/etc/thug/plugins.conf</em></p>
<div class="highlight-sh"><div class="highlight"><pre><span></span><span class="o">[</span>ThugPluginsPre<span class="o">]</span>
plugins: Plugins.TestPlugin

<span class="o">[</span>ThugPluginsPost<span class="o">]</span>
plugins: Plugins.TestPlugin
</pre></div>
</div>
<p>The configuration file plugins.conf defines which plugins are to be loaded in the pre and post-analysis
stages (you can specify many plugins by simply comma separating them). The plugins should contain a
class named <em>Handler</em> which should be compliant with the following interface</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IPlugin</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">thug</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called when the plugin is invoked</span>

<span class="sd">        Parameters:</span>
<span class="sd">        @thug: Thug class main instance</span>
<span class="sd">        @log: Thug root logger</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>If the interface is correctly implemented the <em>run</em> method is called with two parameters: the Thug class
main instance and the Thug root logger. Let&#8217;s see a really simple example of plugin</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zope.interface</span>
<span class="kn">from</span> <span class="nn">.IPlugin</span> <span class="kn">import</span> <span class="n">IPlugin</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IPlugin</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Handler</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thug</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">thug</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
<p>This plugin just logs the parameters but you can do whatever you want. Do you want to pre-check if the URL
domain is within a blacklist? Just do it with a pre-analysis plugin. Do you want to extract and/or correlate
information from the MAEC log files? Just do it with a post-analysis plugin.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build and Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Thug API</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Plugin Framework</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="logging.html" title="previous chapter">Logging</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-2016, Angelo Dell'Aera.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="sources/plugins.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>